<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù€ 500 Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© - Ù…Ø±ÙŠØ­ Ù„Ù„Ø¹ÙŠÙ†</title>
    <style>
        /* ------------------------------------------------ */
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (Dark Mode) */
        /* ------------------------------------------------ */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #121212; /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ø¬Ø¯Ø§Ù‹ */
            color: #E0E0E0; /* Ù„ÙˆÙ† ÙØ§ØªØ­ Ù…Ø±ÙŠØ­ Ù„Ù„Ù†ØµÙˆØµ */
            text-align: center; 
            margin: 0; 
            padding: 10px; 
        }
        h1 { 
            color: #81D4FA; /* Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ Ù…Ø±ÙŠØ­ Ù„Ù„Ø¹Ù†ÙˆØ§Ù† */
            margin-bottom: 20px; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        /* ------------------------------------------------ */
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        /* ------------------------------------------------ */
        .players-container { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px; 
            margin-bottom: 25px; 
        }
        
        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø®Ù„ÙÙŠØ© Ø±Ù…Ø§Ø¯ÙŠØ© Ø£ÙØªØ­ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù‚ */
        .player-card { 
            background-color: #1E1E1E; 
            padding: 15px; 
            border-radius: 12px; 
            border: 1px solid #333333; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .player-name, .round-label { font-size: 1.2em; font-weight: bold; margin-bottom: 5px; color: #B3E5FC; }
        
        /* Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ø¨Ù„ÙˆÙ† Ø£ØµÙØ± Ù…Ø±ÙŠØ­ ÙˆÙˆØ§Ø¶Ø­ */
        .total-score { 
            font-size: 2.5em; 
            color: #FFC107; 
            font-weight: bold; 
            margin-top: 10px;
        } 
        
        /* Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ - Ù„ÙˆÙ† Ø¯Ø§ÙƒÙ† Ø¨Ø®Ù„ÙÙŠØ© Ø±Ù…Ø§Ø¯ÙŠØ© ÙØ§ØªØ­Ø© */
        input[type="number"], input[type="text"] { 
            width: 80%; 
            padding: 10px; 
            margin-top: 10px; 
            border-radius: 8px; 
            border: 1px solid #444444; 
            text-align: center; 
            font-size: 1.1em; 
            background-color: #2D2D2D; /* Ù„ÙˆÙ† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
            color: #E0E0E0; 
        }
        
        /* ------------------------------------------------ */
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø£Ù„ÙˆØ§Ù† Ù…ØªØ¨Ø§ÙŠÙ†Ø© ÙˆÙˆØ§Ø¶Ø­Ø©) */
        /* ------------------------------------------------ */
        .btn { 
            background-color: #4CAF50; /* Ø£Ø®Ø¶Ø± Ù†Ø§ØµØ¹ Ù„Ù„ØªØ³Ø¬ÙŠÙ„ */
            color: white; 
            padding: 15px 30px; 
            border: none; 
            border-radius: 8px; 
            font-size: 1.2em; 
            cursor: pointer; 
            width: 80%; 
            margin-top: 15px; 
            box-shadow: 0 3px 6px rgba(0,0,0,0.3); 
            transition: background-color 0.3s, transform 0.1s;
        }
        .btn:hover { background-color: #66BB6A; } 
        .btn:active { transform: scale(0.98); }
        .btn-reset { 
            background-color: #E53935; /* Ø£Ø­Ù…Ø± Ù„Ù„ØªØµÙÙŠØ± */
            margin-top: 30px; 
            font-size: 1em; 
            padding: 10px 20px; 
        }
        .btn-reset:hover { background-color: #F44336; }
        .btn-edit { 
            background-color: #2196F3; /* Ø£Ø²Ø±Ù‚ Ù„Ù„ØªØ±Ø§Ø¬Ø¹ */
            padding: 10px 20px; 
            font-size: 1em; 
            margin-bottom: 10px; 
        }
        .btn-edit:hover { background-color: #42A5F5; }
        
        /* ------------------------------------------------ */
        /* Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ø§Ù‹) */
        /* ------------------------------------------------ */
        #history-log { 
            margin-top: 40px; 
            padding: 15px; 
            background-color: #1E1E1E; /* Ù†ÙØ³ Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
            border-radius: 12px; 
        }
        #history-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        #history-table th, #history-table td { border: 1px solid #333333; padding: 10px; color: #E0E0E0; }
        #history-table th { 
            background-color: #2D2D2D; /* Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù„ÙˆÙ† Ø¯Ø§ÙƒÙ† */
            color: #81D4FA; 
        }
        #history-table tr:nth-child(even) { 
            background-color: #252525; /* ØµÙÙˆÙ Ø¯Ø§ÙƒÙ†Ø© Ù…ØªÙ†Ø§ÙˆØ¨Ø© */
        }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙÙˆØ²/Ø§Ù„Ø®Ø³Ø§Ø±Ø© (Ù…Ø¹Ø¯Ù„) */
        #winner-msg { display: none; background-color: rgba(0, 0, 0, 0.95); position: fixed; top: 0; left: 0; right: 0; bottom: 0; justify-content: center; align-items: center; flex-direction: column; z-index: 100; }
        #winner-text { 
            font-size: 3em; 
            color: #81D4FA; /* Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ Ù…Ø±ÙŠØ­ */
            margin-bottom: 20px; 
            line-height: 1.3;
        }
    </style>
</head>
<body>

    <h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù€ 500 Ø§Ù„Ù…Ø­Ø¯Ø«Ø© â™ ï¸</h1>
    <div class="round-label" id="round-counter">Ø§Ù„Ø¬ÙˆÙ„Ø©: 1</div>

    <div class="players-container">
        <div class="player-card">
            <input type="text" id="name1" value="Ø§Ù„Ù„Ø§Ø¹Ø¨ 1" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 1">
            <div class="total-score" id="score1">0</div>
            <input type="number" id="input1" placeholder="Ø³Ø¬Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ø´Ø±Ø©" pattern="[0-9]*" inputmode="numeric">
        </div>
        <div class="player-card">
            <input type="text" id="name2" value="Ø§Ù„Ù„Ø§Ø¹Ø¨ 2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 2">
            <div class="total-score" id="score2">0</div>
            <input type="number" id="input2" placeholder="Ø³Ø¬Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ø´Ø±Ø©" pattern="[0-9]*" inputmode="numeric">
        </div>
        <div class="player-card">
            <input type="text" id="name3" value="Ø§Ù„Ù„Ø§Ø¹Ø¨ 3" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 3">
            <div class="total-score" id="score3">0</div>
            <input type="number" id="input3" placeholder="Ø³Ø¬Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ø´Ø±Ø©" pattern="[0-9]*" inputmode="numeric">
        </div>
        <div class="player-card">
            <input type="text" id="name4" value="Ø§Ù„Ù„Ø§Ø¹Ø¨ 4" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 4">
            <div class="total-score" id="score4">0</div>
            <input type="number" id="input4" placeholder="Ø³Ø¬Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ø´Ø±Ø©" pattern="[0-9]*" inputmode="numeric">
        </div>
    </div>

    <button class="btn" onclick="addScores()">Ø³Ø¬Ù‘Ù„ Ø§Ù„Ù†Ø´Ø±Ø©</button>
    <button class="btn btn-reset" onclick="resetGame()">ØªØµÙÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø© (Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©)</button>
    
    <div id="history-log">
        <div class="round-label">Ø³Ø¬Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</div>
        <button class="btn btn-edit" onclick="undoLastRound()">ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø¢Ø®Ø± Ù†Ø´Ø±Ø©</button>
        <table id="history-table">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø¬ÙˆÙ„Ø©</th>
                    <th id="hist-name1">Ø§Ù„Ù„Ø§Ø¹Ø¨ 1</th>
                    <th id="hist-name2">Ø§Ù„Ù„Ø§Ø¹Ø¨ 2</th>
                    <th id="hist-name3">Ø§Ù„Ù„Ø§Ø¹Ø¨ 3</th>
                    <th id="hist-name4">Ø§Ù„Ù„Ø§Ø¹Ø¨ 4</th>
                </tr>
            </thead>
            <tbody id="history-body">
                </tbody>
        </table>
    </div>

    <div id="winner-msg">
        <div id="winner-text"></div>
        <button class="btn" onclick="resetGame()">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©</button>
    </div>

    <script>
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù„Ø­ÙØ¸ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬ÙˆÙ„Ø§Øª
        let totals = [0, 0, 0, 0];
        let history = [];
        let currentRound = 1;
        const WINNING_SCORE = 500; 

        // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        const inputs = [
            document.getElementById('input1'), document.getElementById('input2'),
            document.getElementById('input3'), document.getElementById('input4')
        ];
        const scoresElements = [
            document.getElementById('score1'), document.getElementById('score2'),
            document.getElementById('score3'), document.getElementById('score4')
        ];
        const nameInputs = [
            document.getElementById('name1'), document.getElementById('name2'),
            document.getElementById('name3'), document.getElementById('name4')
        ];
        const histNameHeaders = [
            document.getElementById('hist-name1'), document.getElementById('hist-name2'),
            document.getElementById('hist-name3'), document.getElementById('hist-name4')
        ];
        const historyBody = document.getElementById('history-body');
        const roundCounter = document.getElementById('round-counter');

        // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© 
        function convertArToEn(inputString) {
            if (!inputString) return '0';
            const arabic = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
            const english = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            
            let result = inputString.toString();
            
            for (let i = 0; i < arabic.length; i++) {
                result = result.replace(new RegExp(arabic[i], 'g'), english[i]);
            }
            return result;
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ (Local Storage)
        function saveGame() {
            localStorage.setItem('gameTotals', JSON.stringify(totals));
            localStorage.setItem('gameHistory', JSON.stringify(history));
            localStorage.setItem('currentRound', currentRound);
            nameInputs.forEach((input, index) => {
                localStorage.setItem(`playerName${index + 1}`, input.value);
            });
        }

        function loadGame() {
            const savedTotals = localStorage.getItem('gameTotals');
            const savedHistory = localStorage.getItem('gameHistory');
            const savedRound = localStorage.getItem('currentRound');

            if (savedTotals && savedHistory && savedRound) {
                totals = JSON.parse(savedTotals);
                history = JSON.parse(savedHistory);
                currentRound = parseInt(savedRound);

                nameInputs.forEach((input, index) => {
                    const savedName = localStorage.getItem(`playerName${index + 1}`);
                    if (savedName) {
                        input.value = savedName;
                        histNameHeaders[index].innerText = savedName;
                    }
                });

                for (let i = 0; i < 4; i++) {
                    scoresElements[i].innerText = totals[i];
                }
                roundCounter.innerText = `Ø§Ù„Ø¬ÙˆÙ„Ø©: ${currentRound}`;
                updateHistoryLog();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙŠ Ø±Ø£Ø³ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ±Ù‡Ø§
        nameInputs.forEach((input, index) => {
            input.addEventListener('input', () => {
                histNameHeaders[index].innerText = input.value;
                saveGame();
            });
        });

        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·
        function addScores() {
            let roundScores = [];
            let winnerFound = false;

            for (let i = 0; i < 4; i++) {
                let rawValue = inputs[i].value.trim();
                let enValue = convertArToEn(rawValue);
                let val = parseInt(enValue) || 0; 
                roundScores.push(val);
            }
            
            if (roundScores.every(score => score === 0)) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ø´Ø±Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.');
                return;
            }

            for (let i = 0; i < 4; i++) {
                totals[i] += roundScores[i];
                scoresElements[i].innerText = totals[i];
                inputs[i].value = ''; 
            }

            history.push({
                round: currentRound,
                scores: [...roundScores],
                totals: [...totals]
            });
            saveGame();
            
            updateHistoryLog();

            for (let i = 0; i < 4; i++) {
                if (totals[i] >= WINNING_SCORE) {
                    showWinner(i + 1, nameInputs[i].value);
                    winnerFound = true;
                }
            }

            if (!winnerFound) {
                currentRound++;
                roundCounter.innerText = `Ø§Ù„Ø¬ÙˆÙ„Ø©: ${currentRound}`;
                saveGame();
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„
        function updateHistoryLog() {
            historyBody.innerHTML = '';
            
            history.forEach((roundData) => {
                let row = historyBody.insertRow();
                let cellRound = row.insertCell();
                cellRound.innerText = roundData.round;
                
                roundData.totals.forEach((totalScore, index) => {
                    let cellScore = row.insertCell();
                    let lastScore = roundData.scores[index];
                    cellScore.innerText = `${totalScore} (${lastScore})`;
                    
                    if (totalScore >= WINNING_SCORE) {
                        row.style.backgroundColor = '#E53935aa';
                        row.style.color = 'white';
                    }
                });
            });
            historyBody.scrollTop = historyBody.scrollHeight;
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø¢Ø®Ø± Ù†Ø´Ø±Ø© (ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·)
        function undoLastRound() {
            if (history.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§.');
                return;
            }
            
            const lastRound = history.pop();
            currentRound--;
            
            if (history.length > 0) {
                const previousTotals = history[history.length - 1].totals;
                totals = [...previousTotals];
            } else {
                totals = [0, 0, 0, 0];
            }
            
            for (let i = 0; i < 4; i++) {
                scoresElements[i].innerText = totals[i];
            }
            
            updateHistoryLog();
            saveGame();
            
            roundCounter.innerText = `Ø§Ù„Ø¬ÙˆÙ„Ø©: ${currentRound}`;
            alert(`ØªÙ… Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆÙ„Ø© Ø±Ù‚Ù… ${lastRound.round} Ø¨Ù†Ø¬Ø§Ø­.`);
            document.getElementById('winner-msg').style.display = 'none';
        }

        // ğŸ† Ø¯Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
        function showWinner(playerNum, playerName) {
            document.getElementById('winner-msg').style.display = 'flex';
            document.getElementById('winner-text').innerText = `
                Ù‡Ø§Ø±Ø¯Ù„Ùƒ ÙŠØ§Ù„Ø§Ù…ÙŠØ±
                ${playerName}
            `;
        }

        function resetGame() {
            totals = [0, 0, 0, 0];
            history = [];
            currentRound = 1;

            for (let i = 1; i <= 4; i++) {
                document.getElementById('score' + i).innerText = '0';
                document.getElementById('input' + i).value = '';
            }
            document.getElementById('winner-msg').style.display = 'none';
            document.getElementById('history-body').innerHTML = '';
            document.getElementById('round-counter').innerText = 'Ø§Ù„Ø¬ÙˆÙ„Ø©: 1';
            
            localStorage.clear();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        loadGame();
    </script>

</body>
</html>
